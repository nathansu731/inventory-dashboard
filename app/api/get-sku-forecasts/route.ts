/*
* To be used in forecasts/forecast-navigator page
*
* const res = await fetch("/api/get-sku-forecasts")
*
* */
export async function GET() {
  const apiUrl = process.env.APPSYNC_API_URL
  if (!apiUrl) {
    return Response.json({ error: "Missing APPSYNC_API_URL" }, { status: 500 })
  }
  const apiKey = process.env.APPSYNC_API_KEY
  if (!apiKey) {
    return Response.json({ error: "Missing APPSYNC_API_KEY" }, { status: 500 })
  }

  const query = `
    query GetSKUForecasts {
      getSKUForecasts {
        status
        result
      }
    }
  `

  const response = await fetch(apiUrl, {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      "x-api-key": apiKey
    },
    body: JSON.stringify({ query })
  })

  const json = await response.json()

  return Response.json(json.data.getSKUForecasts)
}
/*
* Response

*  "getSKUForecasts": {
      "result": "{\"budget\":{\"12-2025\":4868,\"11-2025\":5693,\"10-2025\":1516,\"09-2025\":4371,\"08-2025\":4402,\"07-2025\":1328,\"06-2025\":7862,\"05-2025\":7057,\"04-2025\":-666,\"03-2025\":3697,\"02-2025\":5482,\"01-2025\":8898},
      * \"demand\":{\"12-2025\":5102,\"11-2025\":1701,\"10-2025\":9163,\"09-2025\":4806,\"08-2025\":8381,\"07-2025\":3903,\"06-2025\":-772,\"05-2025\":-879,\"04-2025\":8882,\"03-2025\":856,\"02-2025\":3425,\"01-2025\":1815},
      * \"demandAdjustment\":{\"12-2025\":7472,\"11-2025\":4034,\"10-2025\":4139,\"09-2025\":4405,\"08-2025\":1890,\"07-2025\":6973,\"06-2025\":2178,\"05-2025\":3701,\"04-2025\":6950,\"03-2025\":8455,\"02-2025\":6683,\"01-2025\":8043},
      * \"forecastBaseline\":{\"12-2025\":-729,\"11-2025\":2176,\"10-2025\":9392,\"09-2025\":725,\"08-2025\":7257,\"07-2025\":494,\"06-2025\":4146,\"05-2025\":6631,\"04-2025\":3439,\"03-2025\":1037,\"02-2025\":5392,\"01-2025\":-710},
      * \"forecastAdjustment\":{\"12-2025\":3974,\"11-2025\":-902,\"10-2025\":4622,\"09-2025\":7128,\"08-2025\":5742,\"07-2025\":2216,\"06-2025\":9017,\"05-2025\":8924,\"04-2025\":3685,\"03-2025\":1179,\"02-2025\":4656,\"01-2025\":2152},
      * \"previousForecasts\":{\"12-2025\":2189,\"11-2025\":2081,\"10-2025\":924,\"09-2025\":1725,\"08-2025\":6858,\"07-2025\":8168,\"06-2025\":9403,\"05-2025\":-801,\"04-2025\":7767,\"03-2025\":8749,\"02-2025\":1156,\"01-2025\":-911},
      * \"variance\":{\"12-2025\":2657,\"11-2025\":3266,\"10-2025\":3690,\"09-2025\":163,\"08-2025\":698,\"07-2025\":4881,\"06-2025\":4928,\"05-2025\":-708,\"04-2025\":-209,\"03-2025\":2464,\"02-2025\":9684,\"01-2025\":2063},
      * \"revenue\":{\"12-2025\":3250,\"11-2025\":-313,\"10-2025\":4043,\"09-2025\":4682,\"08-2025\":3991,\"07-2025\":1819,\"06-2025\":1796,\"05-2025\":4088,\"04-2025\":7857,\"03-2025\":5980,\"02-2025\":7453,\"01-2025\":8871}}",
      "status": "success"
    },
* */
